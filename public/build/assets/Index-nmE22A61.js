const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MainFilters-CNon5TxU.js","assets/vendor-core-exSyXSqW.js","assets/vendor-icons-C0rekE6d.js","assets/BusinessCard-BD9nTDdX.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./app-Dpu3mrQQ.js";import{r as s,d as T,j as e}from"./vendor-core-exSyXSqW.js";import{M as P}from"./main-layout-XgZxIlet.js";import{p as _,a8 as A,g as I,R as O}from"./vendor-icons-C0rekE6d.js";import{m as N,A as D}from"./drawer-cart-DmonbQGW.js";import"./app-ho6zMTOc.js";import"./index-zdFYkwEh.js";import"./vendor-ui-BC6GVMXR.js";import"./index-BU_B9Ap-.js";import"./CartFloatButton-CwmvMEWj.js";const w="geo_coords",L=1200*1e3;function R(){try{const a=sessionStorage.getItem(w);if(!a)return null;const t=JSON.parse(a);return Date.now()-t.timestamp>L?(sessionStorage.removeItem(w),null):t}catch{return null}}function G(a,t){sessionStorage.setItem(w,JSON.stringify({lat:a,lng:t,timestamp:Date.now()}))}function q(a){const t=a?.enabled??!0,[r,n]=s.useState(null),[o,d]=s.useState(null),[c,m]=s.useState(!1),[g,h]=s.useState(null);return s.useEffect(()=>{if(!t)return;const i=R();if(i){n(i.lat),d(i.lng);return}if(!navigator.geolocation){h("Geolocation not supported");return}m(!0),navigator.geolocation.getCurrentPosition(p=>{const b=p.coords.latitude,y=p.coords.longitude;n(b),d(y),G(b,y),m(!1)},()=>{h("Permission denied"),m(!1)},{enableHighAccuracy:a?.enableHighAccuracy??!1})},[t]),{latitude:r,longitude:o,loading:c,error:g}}const z=s.lazy(()=>E(()=>import("./MainFilters-CNon5TxU.js"),__vite__mapDeps([0,1,2]))),H=s.lazy(()=>E(()=>import("./BusinessCard-BD9nTDdX.js"),__vite__mapDeps([3,1,2]))),j=[{key:"confirmed",label:"Confirmado"},{key:"ready_for_pickup",label:"Por recoger"},{key:"picked_up",label:"Recogido"},{key:"on_the_way",label:"En camino"}],S="active-order-expanded";function se({businesses:a,categories:t,filters:r,products:n,activeOrder:o}){const[d,c]=s.useState(!1),m=s.useRef(null),[g,h]=s.useState(null),[i,p]=s.useState({query:r.q||"",category:r.category||null,distance:r.distance||5,foodType:null}),[b,y]=s.useState(!1),{latitude:x,longitude:f,error:C,loading:v}=q(b?{enableHighAccuracy:!1}:null);s.useEffect(()=>{const l=setTimeout(()=>y(!0),1500);return()=>clearTimeout(l)},[]),s.useEffect(()=>{o&&h({...o,items:o.items??[]})},[o]);const k=s.useCallback(()=>{c(!0);const l={q:i.query,category:i.category,distance:i.distance,foodType:i.foodType},u={};typeof x=="number"&&typeof f=="number"&&(u["X-Latitude"]=x.toString(),u["X-Longitude"]=f.toString()),T.get("/",l,{headers:u,only:["businesses","meta","filters"],preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>c(!1)})},[i,x,f]);return s.useEffect(()=>{if(v)return;const l=JSON.stringify({filtersUser:i,latitude:x,longitude:f});if(m.current===l)return;m.current=l;const u=setTimeout(k,120);return()=>clearTimeout(u)},[i,x,f,v]),e.jsxs(P,{children:[e.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",children:[v&&e.jsx("div",{className:"mx-4 my-2 rounded-xl bg-blue-50 px-3 py-2 text-xs text-blue-600",children:"üìç Obteniendo tu ubicaci√≥n‚Ä¶"}),e.jsx("div",{className:"px-4 pt-2 pb-3",children:e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"h-16 rounded-xl bg-gray-100"}),children:e.jsx(z,{categories:t,filters:i,onFiltersChange:p,foodTypes:n.categories})})}),C&&e.jsxs("div",{className:"mx-4 mb-2 flex items-center gap-2 rounded-full bg-amber-50 px-3 py-1 text-amber-600",children:[e.jsx(_,{size:12}),e.jsx("span",{className:"text-[10px] font-bold",children:"Habilita el GPS"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-40",children:e.jsx(s.Suspense,{fallback:e.jsx(F,{}),children:a.length===0&&!d?e.jsx(B,{distance:i.distance,onIncreaseDistance:l=>p(u=>({...u,distance:l}))}):e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:a.map(l=>e.jsx(H,{business:l},l.id))})})})]}),g&&e.jsx(V,{order:g})]})}const B=({distance:a,onIncreaseDistance:t})=>{const r=Number(a),n=Math.min(Number(r)*2,50);return e.jsxs("div",{className:"flex h-[50vh] flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-purple-100",children:e.jsx(_,{className:"h-7 w-7 text-purple-500"})}),e.jsx("p",{className:"text-sm font-semibold text-purple-900",children:"No encontramos resultados"}),e.jsx("p",{className:"mt-1 max-w-xs text-xs text-gray-500",children:"Prueba ampliando la distancia de b√∫squeda."}),r<40&&e.jsxs("button",{onClick:()=>t(n),className:"mt-4 rounded-xl bg-purple-600 px-4 py-2 text-xs font-semibold text-white shadow-md transition-all hover:bg-purple-700 active:scale-[0.97]",children:["Buscar hasta ",n," km"]})]})},F=()=>e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((a,t)=>e.jsx("div",{className:"h-56 animate-pulse rounded-3xl bg-gray-200"},t))}),K=s.memo(({status:a})=>{const t=j.findIndex(r=>r.key===a);return e.jsx("div",{className:"flex items-start justify-between gap-1",children:j.map((r,n)=>{const o=n<t,d=n===t,c=n>t;return e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsx("div",{className:"mb-1 flex items-center justify-center",children:o?e.jsx(O,{className:"h-4 w-4 text-green-600"}):d?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 w-3 animate-pulse rounded-full bg-purple-600"}),e.jsx("div",{className:"absolute inset-0 h-3 w-3 animate-ping rounded-full bg-purple-600 opacity-25"})]}):e.jsx("div",{className:"h-3 w-3 rounded-full border-2 border-gray-300 bg-transparent"})}),e.jsx("span",{className:`text-center text-[10px] leading-tight font-semibold ${d?"text-purple-800":c?"text-gray-300":"text-gray-600"} `,children:r.label})]},r.key)})})}),M=s.memo(({order:a})=>e.jsxs("div",{className:"space-y-2 rounded-lg border border-purple-200 bg-purple-50 p-1 shadow-sm",children:[e.jsx("div",{className:"mb-4",children:e.jsx(K,{status:a.status})}),e.jsx("div",{className:"space-y-2",children:(a.items??[]).map(t=>e.jsxs("div",{className:"flex justify-between text-sm font-normal text-gray-700",children:[e.jsxs("span",{className:"font-semibold text-purple-800",children:[t.quantity,"√ó"]}),e.jsx("span",{className:"text-gray-600",children:t.name})]},t.id))})]})),V=s.memo(({order:a})=>{const[t,r]=s.useState(()=>typeof window>"u"?!0:sessionStorage.getItem(S)!=="false"),[n,o]=s.useState(!0);s.useEffect(()=>{sessionStorage.setItem(S,String(t))},[t]),s.useEffect(()=>{if(a.status==="delivered"){const c=setTimeout(()=>o(!1),1200);return()=>clearTimeout(c)}},[a.status]);const d=j.findIndex(c=>c.key===a.status);return n?e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-0 z-50 flex justify-center p-1",children:e.jsxs(N.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"pointer-events-auto w-full max-w-md overflow-hidden rounded-2xl border border-purple-200 bg-white/90 shadow-lg backdrop-blur-md",children:[e.jsxs("div",{className:"cursor-pointer px-4 py-3 select-none",onClick:()=>r(!t),children:[e.jsx("div",{className:"mx-auto mb-2 h-1.5 w-12 rounded-full bg-purple-200"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"flex items-center gap-3 pb-1 text-[10px] leading-tight font-bold tracking-wider text-purple-400 uppercase",children:["Pedido activo",t===!1&&e.jsx(A,{className:"h-2 w-2 animate-ping text-green-600"})]}),e.jsxs("p",{className:"text-sm font-bold text-purple-900",children:["ORDEN #",a.id," -"," ",j[d]?.label??""]})]}),e.jsx(N.span,{animate:{rotate:t?180:0},className:"text-purple-500",children:e.jsx(I,{size:20})})]})]}),e.jsx(D,{initial:!1,children:t&&e.jsxs(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:[e.jsx("div",{className:"max-h-[60vh] overflow-y-auto border-t border-purple-100 px-4 py-2",children:e.jsx(M,{order:a})}),e.jsx("div",{className:"bg-purple-50/50 p-4",children:e.jsx("button",{className:"w-full rounded-xl bg-purple-600 py-2.5 text-sm font-semibold text-white shadow-md transition-all hover:bg-purple-700 active:scale-[0.98]",children:"Ver seguimiento del pedido"})})]},"content")})]})}):null});export{se as default};

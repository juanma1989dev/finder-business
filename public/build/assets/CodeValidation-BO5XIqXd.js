import{u as S,j as s,a as x,r as h,b as L,H as F}from"./app-DRnaFo71.js";import{g as P,D as B}from"./dashboard-layout-B63ifu4J.js";import{y as p,L as K}from"./index-Dgc8qQOq.js";import{$ as M}from"./utils-B8V9t6OR.js";import{M as q}from"./shopping-bag-D6HcC1f4.js";import"./app-_ZmoGD8T.js";import"./button-oOZJaIDN.js";import"./index-DAOhb2hJ.js";import"./clsx-COCWedHH.js";import"./createLucideIcon-8cOpsgex.js";import"./index-DXUyvkal.js";import"./index-CDS2P9IT.js";import"./index-_ty5M1Kx.js";import"./index-CJG-LqGM.js";import"./x-BkmaQkV6.js";import"./index-CAsWk8_c.js";import"./index-ByFY5vBa.js";import"./dropdown-menu-DAxWnPxA.js";import"./index-BqgYRoRh.js";import"./index-kNrJbDCw.js";import"./index-BCw_eWvc.js";import"./index-CVASjcgI.js";import"./house-BvvIOFlQ.js";import"./loader-circle-DK9NHL9l.js";import"./arrow-right-FvoTZcqC.js";import"./circle-alert-DLeoRx40.js";import"./printer-CQ4wc93D.js";import"./package-PXuZgzM8.js";import"./shield-check-DZxu-W88.js";import"./star-C33ZpR1w.js";import"./trash-2-B_LJmt8F.js";import"./package-search-CwpuKR2z.js";import"./plus-D6693a4f.js";import"./shopping-cart-CMRXSugC.js";import"./triangle-alert-BPl7zri6.js";class f{constructor(t=0,r="Network Error"){this.status=t,this.text=r}}const D=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},a={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:D()},w=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},O=(e,t="https://api.emailjs.com")=>{if(!e)return;const r=w(e);a.publicKey=r.publicKey,a.blockHeadless=r.blockHeadless,a.storageProvider=r.storageProvider,a.blockList=r.blockList,a.limitRate=r.limitRate,a.origin=r.origin||t},N=async(e,t,r={})=>{const i=await fetch(a.origin+e,{method:"POST",headers:r,body:t}),o=await i.text(),n=new f(i.status,o);if(i.ok)return n;throw n},C=(e,t,r)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},I=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},E=e=>e.webdriver||!e.languages||e.languages.length===0,R=()=>new f(451,"Unavailable For Headless Browser"),$=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},A=e=>!e.list?.length||!e.watchVariable,G=(e,t)=>e instanceof FormData?e.get(t):e[t],T=(e,t)=>{if(A(e))return!1;$(e.list,e.watchVariable);const r=G(t,e.watchVariable);return typeof r!="string"?!1:e.list.includes(r)},H=()=>new f(403,"Forbidden"),U=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},J=async(e,t,r)=>{const i=Number(await r.get(e)||0);return t-Date.now()+i},V=async(e,t,r)=>{if(!t.throttle||!r)return!1;U(t.throttle,t.id);const i=t.id||e;return await J(i,t.throttle,r)>0?!0:(await r.set(i,Date.now().toString()),!1)},_=()=>new f(429,"Too Many Requests"),z=async(e,t,r,i)=>{const o=w(i),n=o.publicKey||a.publicKey,d=o.blockHeadless||a.blockHeadless,b=o.storageProvider||a.storageProvider,m={...a.blockList,...o.blockList},l={...a.limitRate,...o.limitRate};return d&&E(navigator)?Promise.reject(R()):(C(n,e,t),I(r),r&&T(m,r)?Promise.reject(H()):await V(location.pathname,l,b)?Promise.reject(_()):N("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:n,service_id:e,template_id:t,template_params:r}),{"Content-type":"application/json"}))},W=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Q=e=>typeof e=="string"?document.querySelector(e):e,X=async(e,t,r,i)=>{const o=w(i),n=o.publicKey||a.publicKey,d=o.blockHeadless||a.blockHeadless,b=a.storageProvider||o.storageProvider,m={...a.blockList,...o.blockList},l={...a.limitRate,...o.limitRate};if(d&&E(navigator))return Promise.reject(R());const u=Q(r);C(n,e,t),W(u);const c=new FormData(u);return T(m,c)?Promise.reject(H()):await V(location.pathname,l,b)?Promise.reject(_()):(c.append("lib_version","4.4.1"),c.append("service_id",e),c.append("template_id",t),c.append("user_id",n),N("/api/v1.0/email/send-form",c))},Y={init:O,send:z,sendForm:X,EmailJSResponseStatus:f};function Z({props:e,setStausCodeValidation:t,setGeneratedCode:r,urlBusiness:i}){const{auth:o,flash:n}=e,{user:d}=o,{data:b,post:m,processing:l}=S({email:d?.email||""}),u=()=>{m("/dashboard/profile/business/code-to-create",{preserveScroll:!0,onSuccess:c=>{const y=c.props?.flash?.meta,g=P(y,"code");if(!g){p.error("No se pudo obtener el código.");return}const j={codigo:g,name:d?.name,email:d?.email};Y.send("service_20p7y6r","template_qz241al",j,{publicKey:"x_RrCLCpP0c42oE-t"}).then(()=>{t(!0),r(g)},()=>p.error("Error al enviar el código."))},onError:()=>p.error("Error al generar el código.")})};return s.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center gap-6 p-3",children:[s.jsx("h1",{className:"text-xl font-bold",children:"Generar código"}),s.jsxs("div",{className:"w-full max-w-lg text-center",children:[s.jsx("p",{children:"Para registrar su negocio, es necesario validar previamente su identidad."}),s.jsx("p",{children:"Enviaremos un código de confirmación a su correo electrónico."})]}),s.jsxs("div",{className:"flex w-full max-w-lg justify-center gap-5",children:[s.jsxs("button",{disabled:l,className:`flex items-center gap-3 rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 ${l?"cursor-not-allowed bg-gray-400":"cursor-pointer bg-gray-200 hover:bg-gray-300"}`,onClick:()=>x.get(i),children:[s.jsx(M,{className:"h-4 w-4"}),"Cancelar"]}),s.jsxs("button",{onClick:u,disabled:l,className:`flex items-center justify-center gap-3 rounded-md bg-sky-600 px-4 py-2 text-white hover:bg-sky-700 ${l?"cursor-not-allowed bg-gray-400":"cursor-pointer"}`,children:[s.jsx(q,{className:"h-4 w-4"}),l?s.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"}):"Recibir código"]})]})]})}function ee({props:e,code:t}){const[r,i]=h.useState(180),[o,n]=h.useState(""),{auth:d}=L().props,{user:b}=d,m=b?.email,{processing:l,post:u}=S({code:t,email:m});h.useEffect(()=>{t&&p.success("El código se envió correctamente.")},[]);const c=async()=>{o===t?u("/dashboard/profile/business/validate-code",{preserveScroll:!0,onSuccess:v=>{const g=v.props?.flash?.meta;if(P(g,"validated")>0)return x.get("/dashboard/business/create",{validate:btoa(t)});p.error("Error al validar el código")},onError:()=>{p.error("Error al validar el código")}}):p.error("Código incorrecto")};return s.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6 p-3 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:s.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[s.jsxs("span",{children:["El código es válido por: ",Math.floor(r/60),":",(r%60).toString().padStart(2,"0")," minutos."]}),s.jsx("input",{type:"text",placeholder:"Ingresa el código",value:o,onChange:v=>n(v.target.value),className:"w-full rounded-md border p-2"}),s.jsx("button",{onClick:c,disabled:l,className:`flex items-center justify-center rounded-md px-4 py-2 text-white ${l?"cursor-not-allowed bg-green-300":"cursor-pointer bg-green-500 hover:opacity-90"}`,children:l?s.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"}):"Validar código"})]})})}const te=[{title:"Dashboard - Nuevo negocio",href:""}],k="/dashboard/profile/business/";function Ke({numBusiness:e}){const[t,r]=h.useState(!1),[i,o]=h.useState(null),n=L().props;return e>=5?x.visit(k):s.jsxs(B,{breadcrumbs:te,children:[s.jsx(K,{}),s.jsx(F,{title:"Dashboard - Nuevo negocio - "}),s.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:s.jsx("div",{className:"relative min-h-[100vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:!t&&!i?s.jsx(Z,{props:n,stausCodeValidation:t,setStausCodeValidation:r,generatedCode:i,setGeneratedCode:o,urlBusiness:k}):s.jsx(ee,{props:n,code:i})})})]})}export{Ke as default};

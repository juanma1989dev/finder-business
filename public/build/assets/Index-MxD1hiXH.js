const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MainFilters-DNgumEKY.js","assets/vendor-core-CVn978f7.js","assets/vendor-icons-BvP0H4xj.js","assets/BusinessCard-C3ra6NC_.js"])))=>i.map(i=>d[i]);
import{_ as v}from"./app-CQrnIAdu.js";import{r as t,d as T,j as e}from"./vendor-core-CVn978f7.js";import{u as C}from"./use-Geolocation-DZfnMrFf.js";import{M as P}from"./main-layout-D8k80jl2.js";import{C as N,a as R,b as A,c as D}from"./vendor-icons-BvP0H4xj.js";import{m as h,A as I}from"./drawer-cart-DypxYsUP.js";import"./app-DQJAPa6p.js";import"./index-CZyFl0Li.js";import"./vendor-ui-CpttHis2.js";import"./index-BU_B9Ap-.js";import"./firebase-B2pyU7xz.js";import"./CartFloatButton-BQZCgCMY.js";import"./ProviderLayout-Adcfx3ho.js";const O=t.lazy(()=>v(()=>import("./MainFilters-DNgumEKY.js"),__vite__mapDeps([0,1,2]))),L=t.lazy(()=>v(()=>import("./BusinessCard-C3ra6NC_.js"),__vite__mapDeps([3,1,2]))),x=[{key:"confirmed",label:"Confirmado"},{key:"ready_for_pickup",label:"Por recoger"},{key:"picked_up",label:"Recogido"},{key:"on_the_way",label:"En camino"}],y="active-order-expanded";function se({businesses:a,categories:s,filters:r,products:l,activeOrder:o}){const[u,c]=t.useState(!1),g=t.useRef(null),[b,w]=t.useState(null),[n,j]=t.useState({query:r.q||"",category:r.category||null,distance:r.distance||5,foodType:null}),[S,E]=t.useState(!1),{latitude:m,longitude:p,error:k,loading:f}=C(S?{enableHighAccuracy:!1}:null);t.useEffect(()=>{const i=setTimeout(()=>E(!0),1500);return()=>clearTimeout(i)},[]),t.useEffect(()=>{o&&w({...o,items:o.items??[]})},[o]);const _=t.useCallback(()=>{c(!0);const i={q:n.query,category:n.category,distance:n.distance,foodType:n.foodType},d={};typeof m=="number"&&typeof p=="number"&&(d["X-Latitude"]=m.toString(),d["X-Longitude"]=p.toString()),T.get("/",i,{headers:d,only:["businesses","meta","filters"],preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>c(!1)})},[n,m,p]);return t.useEffect(()=>{if(f)return;const i=JSON.stringify({filtersUser:n,latitude:m,longitude:p});if(g.current===i)return;g.current=i;const d=setTimeout(_,120);return()=>clearTimeout(d)},[n,m,p,f]),e.jsxs(P,{children:[e.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",children:[f&&e.jsx("div",{className:"mx-4 my-2 rounded-xl bg-blue-50 px-3 py-2 text-xs text-blue-600",children:"üìç Obteniendo tu ubicaci√≥n‚Ä¶"}),e.jsx("div",{className:"px-4 pt-2 pb-3",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-16 rounded-xl bg-gray-100"}),children:e.jsx(O,{categories:s,filters:n,onFiltersChange:j,foodTypes:l.categories})})}),k&&e.jsxs("div",{className:"mx-4 mb-2 flex items-center gap-2 rounded-full bg-amber-50 px-3 py-1 text-amber-600",children:[e.jsx(N,{size:12}),e.jsx("span",{className:"text-[10px] font-bold",children:"Habilita el GPS"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-40",children:e.jsx(t.Suspense,{fallback:e.jsx(z,{}),children:a.length===0&&!u?e.jsx(q,{distance:n.distance,onIncreaseDistance:i=>j(d=>({...d,distance:i}))}):e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:a.map(i=>e.jsx(L,{business:i},i.id))})})})]}),b&&e.jsx(F,{order:b})]})}const q=({distance:a,onIncreaseDistance:s})=>{const r=Number(a),l=Math.min(Number(r)*2,50);return e.jsxs("div",{className:"flex h-[50vh] flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-purple-100",children:e.jsx(N,{className:"h-7 w-7 text-purple-500"})}),e.jsx("p",{className:"text-sm font-semibold text-purple-900",children:"No encontramos resultados"}),e.jsx("p",{className:"mt-1 max-w-xs text-xs text-gray-500",children:"Prueba ampliando la distancia de b√∫squeda."}),r<40&&e.jsxs("button",{onClick:()=>s(l),className:"mt-4 rounded-xl bg-purple-600 px-4 py-2 text-xs font-semibold text-white shadow-md transition-all hover:bg-purple-700 active:scale-[0.97]",children:["Buscar hasta ",l," km"]})]})},z=()=>e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((a,s)=>e.jsx("div",{className:"h-56 animate-pulse rounded-3xl bg-gray-200"},s))}),B=t.memo(({status:a})=>{const s=x.findIndex(r=>r.key===a);return e.jsx("div",{className:"flex items-start justify-between gap-1",children:x.map((r,l)=>{const o=l<s,u=l===s,c=l>s;return e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsx("div",{className:"mb-1 flex items-center justify-center",children:o?e.jsx(D,{className:"h-4 w-4 text-green-600"}):u?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 w-3 animate-pulse rounded-full bg-purple-600"}),e.jsx("div",{className:"absolute inset-0 h-3 w-3 animate-ping rounded-full bg-purple-600 opacity-25"})]}):e.jsx("div",{className:"h-3 w-3 rounded-full border-2 border-gray-300 bg-transparent"})}),e.jsx("span",{className:`text-center text-[10px] leading-tight font-semibold ${u?"text-purple-800":c?"text-gray-300":"text-gray-600"} `,children:r.label})]},r.key)})})}),G=t.memo(({order:a})=>e.jsxs("div",{className:"space-y-2 rounded-lg border border-purple-200 bg-purple-50 p-1 shadow-sm",children:[e.jsx("div",{className:"mb-4",children:e.jsx(B,{status:a.status})}),e.jsx("div",{className:"space-y-2",children:(a.items??[]).map(s=>e.jsxs("div",{className:"flex justify-between text-sm font-normal text-gray-700",children:[e.jsxs("span",{className:"font-semibold text-purple-800",children:[s.quantity,"√ó"]}),e.jsx("span",{className:"text-gray-600",children:s.name})]},s.id))})]})),F=t.memo(({order:a})=>{const[s,r]=t.useState(()=>typeof window>"u"?!0:sessionStorage.getItem(y)!=="false"),[l,o]=t.useState(!0);t.useEffect(()=>{sessionStorage.setItem(y,String(s))},[s]),t.useEffect(()=>{if(a.status==="delivered"){const c=setTimeout(()=>o(!1),1200);return()=>clearTimeout(c)}},[a.status]);const u=x.findIndex(c=>c.key===a.status);return l?e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-0 z-50 flex justify-center p-1",children:e.jsxs(h.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"pointer-events-auto w-full max-w-md overflow-hidden rounded-2xl border border-purple-200 bg-white/90 shadow-lg backdrop-blur-md",children:[e.jsxs("div",{className:"cursor-pointer px-4 py-3 select-none",onClick:()=>r(!s),children:[e.jsx("div",{className:"mx-auto mb-2 h-1.5 w-12 rounded-full bg-purple-200"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"flex items-center gap-3 pb-1 text-[10px] leading-tight font-bold tracking-wider text-purple-400 uppercase",children:["Pedido activo",s===!1&&e.jsx(R,{className:"h-2 w-2 animate-ping text-green-600"})]}),e.jsxs("p",{className:"text-sm font-bold text-purple-900",children:["ORDEN #",a.id," -"," ",x[u]?.label??""]})]}),e.jsx(h.span,{animate:{rotate:s?180:0},className:"text-purple-500",children:e.jsx(A,{size:20})})]})]}),e.jsx(I,{initial:!1,children:s&&e.jsxs(h.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:[e.jsx("div",{className:"max-h-[60vh] overflow-y-auto border-t border-purple-100 px-4 py-2",children:e.jsx(G,{order:a})}),e.jsx("div",{className:"bg-purple-50/50 p-4",children:e.jsx("button",{className:"w-full rounded-xl bg-purple-600 py-2.5 text-sm font-semibold text-white shadow-md transition-all hover:bg-purple-700 active:scale-[0.98]",children:"Ver seguimiento del pedido"})})]},"content")})]})}):null});export{se as default};

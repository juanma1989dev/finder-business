import{r as c,G as h,u as H,j as a}from"./vendor-core-exSyXSqW.js";import{C as N,a as k}from"./card-K3rwxPgh.js";import{I as F}from"./input-wNND2qct.js";import{L as E}from"./label-BXmSQRKV.js";import{S as A,a as U,b as V,c as B,d as D}from"./select-DVnQp52_.js";import{l as y}from"./locations-zddfFc1m.js";import{m as G}from"./dashboard-layout-DXpEtdR1.js";import{l as j}from"./app-4x3lTc24.js";import{y as R}from"./index-zdFYkwEh.js";import{LayoutBusinessModules as _}from"./LayoutBusinessModules-ByYnMWwz.js";import{a6 as X,q as Z,e as $}from"./vendor-icons-LnSNrRoU.js";import"./utils-posDTYbB.js";import"./vendor-ui-BC6GVMXR.js";import"./button-BzGKoXYt.js";import"./dropdown-menu-DYMDyklQ.js";import"./index-CN9EY2cw.js";import"./index-CVASjcgI.js";import"./index-BU_B9Ap-.js";import"./app-ho6zMTOc.js";function q(n,t){const e=c.useRef(t);c.useEffect(function(){t!==e.current&&n.attributionControl!=null&&(e.current!=null&&n.attributionControl.removeAttribution(e.current),t!=null&&n.attributionControl.addAttribution(t)),e.current=t},[n,t])}const J=1;function K(n){return Object.freeze({__version:J,map:n})}function Q(n,t){return Object.freeze({...n,...t})}const C=c.createContext(null);function I(){const n=c.use(C);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function W(n){function t(e,r){const{instance:o,context:i}=n(e).current;c.useImperativeHandle(r,()=>o);const{children:u}=e;return u==null?null:h.createElement(C,{value:i},u)}return c.forwardRef(t)}function Y(n){function t(e,r){const{instance:o}=n(e).current;return c.useImperativeHandle(r,()=>o),null}return c.forwardRef(t)}function P(n,t){const e=c.useRef(void 0);c.useEffect(function(){return t!=null&&n.instance.on(t),e.current=t,function(){e.current!=null&&n.instance.off(e.current),e.current=null}},[n,t])}function S(n,t){const e=n.pane??t.pane;return e?{...n,pane:e}:n}function O(n,t,e){return Object.freeze({instance:n,context:t,container:e})}function w(n,t){return t==null?function(r,o){const i=c.useRef(void 0);return i.current||(i.current=n(r,o)),i}:function(r,o){const i=c.useRef(void 0);i.current||(i.current=n(r,o));const u=c.useRef(r),{instance:s}=i.current;return c.useEffect(function(){u.current!==r&&(t(s,r,u.current),u.current=r)},[s,r,t]),i}}function ee(n,t){c.useEffect(function(){return(t.layerContainer??t.map).addLayer(n.instance),function(){t.layerContainer?.removeLayer(n.instance),t.map.removeLayer(n.instance)}},[t,n])}function z(n){return function(e){const r=I(),o=n(S(e,r),r);return q(r.map,e.attribution),P(o.current,e.eventHandlers),ee(o.current,r),o}}function te(n,t){const e=w(n,t),r=z(e);return W(r)}function ne(n,t){const e=w(n,t),r=z(e);return Y(r)}function re(n,t,e){const{opacity:r,zIndex:o}=t;r!=null&&r!==e.opacity&&n.setOpacity(r),o!=null&&o!==e.zIndex&&n.setZIndex(o)}function ae(){return I().map}function oe({bounds:n,boundsOptions:t,center:e,children:r,className:o,id:i,placeholder:u,style:s,whenReady:f,zoom:x,...g},p){const[l]=c.useState({className:o,id:i,style:s}),[d,b]=c.useState(null),L=c.useRef(void 0);c.useImperativeHandle(p,()=>d?.map??null,[d]);const M=c.useCallback(v=>{if(v!==null&&!L.current){const m=new j.Map(v,g);L.current=m,e!=null&&x!=null?m.setView(e,x):n!=null&&m.fitBounds(n,t),f!=null&&m.whenReady(f),b(K(m))}},[]);c.useEffect(()=>()=>{d?.map.remove()},[d]);const T=d?h.createElement(C,{value:d},r):u??null;return h.createElement("div",{...l,ref:M},T)}const ce=c.forwardRef(oe),se=te(function({position:t,...e},r){const o=new j.Marker(t,e);return O(o,Q(r,{overlayContainer:o}))},function(t,e,r){e.position!==r.position&&t.setLatLng(e.position),e.icon!=null&&e.icon!==r.icon&&t.setIcon(e.icon),e.zIndexOffset!=null&&e.zIndexOffset!==r.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),t.dragging!=null&&e.draggable!==r.draggable&&(e.draggable===!0?t.dragging.enable():t.dragging.disable())}),ie=ne(function({url:t,...e},r){const o=new j.TileLayer(t,S(e,r));return O(o,r)},function(t,e,r){re(t,e,r);const{url:o}=e;o!=null&&o!==r.url&&t.setUrl(o)});function le({position:n,enabled:t}){const e=ae();return c.useEffect(()=>{t&&e.flyTo(n,16,{animate:!0,duration:.5})},[n,t,e]),null}function Oe({business:n}){const t=G({text:"Ubicación",url:"#"}),e=y.NOCHIXTLAN.cords,[r,o]=c.useState(!1),[i,u]=c.useState(!1),{data:s,setData:f,put:x,processing:g}=H({location:n.location,address:n.address,cords:{lat:n?.cords?.coordinates?.[1]??e.lat,long:n?.cords?.coordinates?.[0]??e.long}});c.useEffect(()=>{const l=setTimeout(()=>o(!0),100);return()=>clearTimeout(l)},[]);const p=()=>{x(`/dashboard/business/${n.id}-${n.slug}/location`,{preserveScroll:!0,onSuccess:()=>R.success("Ubicación actualizada correctamente"),onError:()=>R.error("Error al guardar")})};return a.jsxs(_,{titleHead:"Localización",headerTitle:"Ubicación",headerDescription:"Configura la localización física del negocio",buttonText:"Guardar cambios",icon:X,onSubmit:p,processing:g,breadcrumbs:t,children:[a.jsx("div",{className:"space-y-6 lg:col-span-4",children:a.jsx(N,{className:"rounded-lg border-purple-200 shadow-sm",children:a.jsxs(k,{className:"space-y-4 p-3",children:[a.jsxs("div",{children:[a.jsx(E,{className:"mb-1 block text-[10px] font-semibold tracking-widest text-gray-500 uppercase",children:"Municipio / Localidad"}),a.jsxs(A,{value:s.location,onValueChange:l=>{u(!0),f({...s,location:l,cords:y[l].cords,address:""})},children:[a.jsx(U,{children:a.jsx(V,{placeholder:"Seleccionar…"})}),a.jsx(B,{children:Object.entries(y).map(([l,d])=>a.jsx(D,{value:l,children:d.name},l))})]})]}),a.jsxs("div",{children:[a.jsx(E,{className:"mb-1 block text-[10px] font-semibold tracking-widest text-gray-500 uppercase",children:"Dirección"}),a.jsx(F,{value:s.address,onChange:l=>f("address",l.target.value),placeholder:"Calle, número, colonia…"}),a.jsxs("div",{className:"mt-3 flex gap-2 rounded-lg border border-amber-200 bg-amber-50 p-2",children:[a.jsx(Z,{size:14,className:"text-amber-600"}),a.jsx("p",{className:"flex text-sm text-amber-700",children:"Ajusta el marcador para mayor precisión."})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[a.jsxs("div",{className:"rounded-lg border bg-gray-50 p-2 text-center",children:[a.jsx("span",{className:"block text-[9px] text-gray-500 uppercase",children:"Latitud"}),a.jsx("span",{className:"font-mono text-xs",children:s.cords.lat.toFixed(6)})]}),a.jsxs("div",{className:"rounded-lg border bg-gray-50 p-2 text-center",children:[a.jsx("span",{className:"block text-[9px] text-gray-500 uppercase",children:"Longitud"}),a.jsx("span",{className:"font-mono text-xs",children:s.cords.long.toFixed(6)})]})]})]})})}),a.jsx("div",{className:"relative lg:col-span-8",children:a.jsxs(N,{className:"relative h-[520px] overflow-hidden rounded-lg p-0",children:[!r&&a.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-white/60",children:a.jsx($,{className:"animate-spin"})}),r&&a.jsxs(ce,{center:[s.cords.lat,s.cords.long],zoom:16,style:{height:"100%",width:"100%"},children:[a.jsx(ie,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}),a.jsx(se,{position:[s.cords.lat,s.cords.long],draggable:!0,eventHandlers:{dragend:l=>{const{lat:d,lng:b}=l.target.getLatLng();u(!1),f("cords",{lat:Number(d.toFixed(6)),long:Number(b.toFixed(6))})}}}),a.jsx(le,{enabled:i,position:[s.cords.lat,s.cords.long]})]})]})})]})}export{Oe as default};

import{r as o,j as e,b as _,a as S}from"./app-DkDB_8CB.js";import{B as P}from"./BusinessCard-1Wo_nCD_.js";import{a as C}from"./star-BJgUuVE2.js";import{w as A,x as z,s as L,U as q,y as F,z as M}from"./utils-CfzZyKvo.js";import{C as U,a as $}from"./card-DBCK3lRd.js";import{D as O,a as R,b as X,c as B}from"./dialog-kdlS7D-j.js";import{M as H}from"./main-layout-BtHA0Npo.js";import{a as J}from"./clsx--lBOLjvq.js";import{C as Q}from"./circle-alert-BM5BSp8j.js";import{C as G}from"./printer-DRzafObI.js";import"./app-CGfczU0M.js";import"./arrow-right-BkUc17Rt.js";import"./createLucideIcon-a_qB-A08.js";import"./shopping-bag-DxRCLEcD.js";import"./package-BU1OvDV9.js";import"./house-BKZxKSjy.js";import"./shield-check-DJA5_I73.js";import"./loader-circle-CkAJu07Z.js";import"./trash-2-BdFRsBj0.js";import"./package-search-DrzKzZru.js";import"./plus-Cz8WvdQW.js";import"./shopping-cart-Cxh0H1UY.js";import"./triangle-alert-CccrTqft.js";import"./x-BURC3Ppq.js";import"./index-BJsFzrv2.js";import"./index-Cybp8v3T.js";import"./index-tO81QAJn.js";import"./index-CNzvj9uQ.js";import"./index-CcpYGMtr.js";import"./index-CVeAyMPK.js";import"./CartFloatButton-BfPLGnx5.js";import"./drawer-cart-CdoLFGTu.js";const K=[{label:"5 km",value:5},{label:"10 km",value:10},{label:"15 km",value:15},{label:"20 km",value:20}];function V({categories:i,filters:t,onFiltersChange:n,foodTypes:d}){const[r,g]=o.useState(t?.query||"");o.useEffect(()=>{const a=setTimeout(()=>{t&&n({...t,query:r})},500);return()=>clearTimeout(a)},[r]);const c=(a,b)=>{n({...t,[a]:b||null})};return e.jsxs("div",{className:"mx-auto w-full max-w-7xl space-y-5 p-1",children:[e.jsx("div",{className:"rounded-2xl border border-gray-100 bg-white p-2 shadow-lg shadow-purple-900/5 transition-all sm:rounded-full",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:flex-row",children:[e.jsxs("div",{className:"group relative w-full sm:flex-[1.5]",children:[e.jsx(C,{className:"absolute top-1/2 left-4 h-4 w-4 -translate-y-1/2 text-gray-400 transition-colors group-focus-within:text-orange-500"}),e.jsx("input",{type:"text",placeholder:"¿Qué te apetece hoy?",value:r,onChange:a=>g(a.target.value),className:"w-full rounded-xl border-none bg-gray-50/50 py-2.5 pr-10 pl-10 text-sm transition-all focus:ring-2 focus:ring-orange-500/20 sm:rounded-full"}),r&&e.jsx("button",{onClick:()=>g(""),className:"absolute top-1/2 right-3 -translate-y-1/2",children:e.jsx(A,{className:"h-4 w-4 text-gray-300 hover:text-orange-500"})})]}),e.jsx("div",{className:"mx-1 hidden h-6 w-px bg-gray-100 sm:block"}),e.jsxs("div",{className:"flex w-full items-center gap-2 sm:w-auto",children:[e.jsxs("div",{className:"flex flex-1 cursor-pointer items-center gap-2 rounded-xl border border-purple-100/50 bg-purple-50/50 px-3 py-2 transition-colors hover:bg-purple-50 sm:flex-none sm:rounded-full",children:[e.jsx(z,{className:"h-3.5 w-3.5 text-purple-600"}),e.jsxs("select",{value:t?.category??"",onChange:a=>c("category",a.target.value),className:"min-w-[80px] cursor-pointer appearance-none bg-transparent text-[13px] font-semibold text-purple-900 focus:outline-none",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),i.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex flex-1 cursor-pointer items-center gap-2 rounded-xl border border-orange-100/50 bg-orange-50/50 px-3 py-2 transition-colors hover:bg-orange-50 sm:flex-none sm:rounded-full",children:[e.jsx(L,{className:"h-3.5 w-3.5 text-orange-600"}),e.jsxs("select",{value:t?.distance??"",onChange:a=>c("distance",a.target.value),className:"min-w-[80px] cursor-pointer appearance-none bg-transparent text-[13px] font-semibold text-orange-900 focus:outline-none",children:[e.jsx("option",{value:"",children:"Distancia"}),K.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]})]})]})}),e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between px-1",children:e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-extrabold tracking-widest text-gray-800 uppercase",children:[e.jsx("span",{className:"h-[2px] w-8 bg-purple-600"}),"Especialidades"]})}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"no-scrollbar flex gap-6 overflow-x-auto scroll-smooth px-1 pb-2",children:[e.jsxs("button",{onClick:()=>c("foodType",""),className:"group flex min-w-[44px] flex-col items-center gap-2",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-2xl transition-all duration-300 ${t.foodType?"border border-gray-100 bg-white text-purple-600 shadow-sm hover:border-purple-200":"scale-105 bg-purple-600 text-white shadow-lg ring-4 shadow-purple-200 ring-purple-100"} `,children:e.jsx(q,{className:"h-5 w-5"})}),e.jsx("span",{className:`text-[11px] font-bold ${t.foodType?"text-gray-500":"text-purple-700"}`,children:"Todos"})]}),d.map(a=>e.jsxs("button",{onClick:()=>c("foodType",a.id),className:"flex min-w-[44px] flex-col items-center gap-2",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-2xl text-2xl transition-all duration-300 ${t.foodType===a.id?"scale-105 bg-orange-500 text-white shadow-lg ring-4 shadow-orange-200 ring-orange-100":"border border-gray-100 bg-white shadow-sm hover:scale-105"} `,children:e.jsx("span",{className:t.foodType===a.id?"brightness-125":"grayscale-[0.4]",children:a.icon})}),e.jsx("span",{className:`text-[11px] font-bold ${t.foodType===a.id?"text-orange-700":"text-gray-500"}`,children:a.name})]},a.id))]})})]})]})}function W(i={}){const{enableHighAccuracy:t=!0,timeout:n=1e4,maximumAge:d=0,enableIPFallback:r=!0,ipApiUrl:g="https://ipapi.co/json/",cacheMinutes:c=30}=i,a="geolocation_cache",[b,u]=o.useState({latitude:null,longitude:null,accuracy:null,error:null,loading:!0,source:null}),m=o.useRef(!0),h=o.useCallback(async()=>{try{const s=await fetch(g);if(!s.ok)throw new Error("Error al obtener ubicación por IP");const l=await s.json();if(m.current&&l.latitude&&l.longitude){const f={latitude:l.latitude,longitude:l.longitude,accuracy:null,error:null,loading:!1,source:"ip"};u(f);const y={latitude:l.latitude,longitude:l.longitude,accuracy:null,timestamp:Date.now(),expiresAt:Date.now()+c*60*1e3,source:"ip"};localStorage.setItem(a,JSON.stringify(y))}}catch{m.current&&u(l=>({...l,loading:!1,error:"No se pudo obtener la ubicación"}))}},[g,c]),j=o.useCallback(()=>{u(s=>({...s,loading:!0,error:null}));try{const s=localStorage.getItem(a);if(s){const l=JSON.parse(s);if(Date.now()<l.expiresAt){u({latitude:l.latitude,longitude:l.longitude,accuracy:l.accuracy,error:null,loading:!1,source:"cache"});return}localStorage.removeItem(a)}}catch{localStorage.removeItem(a)}if(!navigator.geolocation){r?h():u(s=>({...s,loading:!1,error:"No soportado"}));return}navigator.geolocation.getCurrentPosition(s=>{if(!m.current)return;const l={latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy,error:null,loading:!1,source:"navigator"};u(l);const f={latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy,timestamp:Date.now(),expiresAt:Date.now()+c*60*1e3,source:"navigator"};localStorage.setItem(a,JSON.stringify(f))},s=>{r?h():u(l=>({...l,loading:!1,error:s.message}))},{enableHighAccuracy:t,timeout:n,maximumAge:d})},[t,n,d,r,h,c]);return o.useEffect(()=>(m.current=!0,j(),()=>{m.current=!1}),[j]),{...b,refresh:()=>{localStorage.removeItem(a),j()},clearCache:()=>localStorage.removeItem(a)}}const T=[{key:"pending",label:"Creado"},{key:"confirmed",label:"Confirmado"},{key:"ready_for_pickup",label:"Listo para recoger"},{key:"picked_up",label:"Recogido"},{key:"on_the_way",label:"En camino"},{key:"delivered",label:"Entregado"}];function _e({businesses:i,categories:t,filters:n,products:d,activeOrder:r}){const[g,c]=o.useState(!1),[a,b]=o.useState(!0),[u,m]=o.useState(!1),[h,j]=o.useState(null),[p,N]=o.useState({query:n.q||"",category:n.category||null,distance:n.distance||5,foodType:null}),{auth:s}=_().props,l=s.user,f=o.useRef(!0),{latitude:y,longitude:w,error:E,loading:k}=W({enableHighAccuracy:!0,enableIPFallback:!0}),I=o.useCallback(()=>{c(!0);const x={q:p.query,category:p.category,distance:p.distance,foodType:p.foodType},v={};y&&w&&(v["X-Latitude"]=y.toString(),v["X-Longitude"]=w.toString()),S.get("/",x,{headers:v,preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>c(!1)})},[p,y,w]);return o.useEffect(()=>{if(f.current){f.current=!1;return}k||I()},[p,k]),e.jsxs(H,{children:[e.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",children:[e.jsx("div",{className:"px-4 pt-2 pb-3",children:e.jsx(V,{categories:t,filters:p,onFiltersChange:N,foodTypes:d.categories})}),r?.id&&l.type=="client"&&e.jsx("div",{className:"px-4 pb-3",children:e.jsx(U,{className:"overflow-hidden border-none bg-purple-600 shadow-lg ring-1 ring-white/20",children:e.jsxs($,{className:"p-0",children:[e.jsxs("div",{className:"flex cursor-pointer items-center justify-between p-3 text-white active:bg-purple-700",onClick:()=>b(!a),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(F,{size:25,className:"animate-pulse"}),e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-green-800 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-green-100"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold tracking-widest uppercase opacity-70",children:"En curso"}),e.jsx("span",{className:"text-sm font-bold",children:T.find(x=>x.key===r.status)?.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),S.get(`/orders/${r.id}`,{},{only:["order"],onSuccess:v=>{j(v.props.order),m(!0)}})},className:"rounded-full bg-white/20 px-4 py-1.5 text-xs font-bold transition-all hover:bg-white/30",children:"Ver orden"}),a?e.jsx(J,{size:18}):e.jsx(M,{size:18})]})]}),!a&&e.jsx("div",{className:"border-t border-white/10 bg-white p-4",children:e.jsx(D,{status:r.status})})]})})}),E&&e.jsxs("div",{className:"mx-4 mb-2 flex items-center justify-center gap-2 rounded-full bg-amber-50 py-1 text-amber-600 ring-1 ring-amber-100",children:[e.jsx(Q,{size:12}),e.jsx("span",{className:"text-[10px] font-bold",children:"Habilita el GPS para ver distancia real"})]})]}),e.jsxs("div",{className:"scrollbar-hide flex-1 overflow-y-auto px-4 pb-24",children:[g&&i.length>0&&e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-0 z-20 h-1 animate-pulse bg-indigo-600"}),e.jsx("div",{className:"relative py-2",children:i.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:i.map(x=>e.jsx(P,{business:x,modeEdit:!1},x.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-40",children:[e.jsx(C,{size:48,strokeWidth:1}),e.jsx("p",{className:"mt-4 text-sm font-medium",children:"Sin resultados por aquí"})]})})]})]}),e.jsx(O,{open:u,onOpenChange:m,children:e.jsx(R,{className:"fixed top-auto bottom-0 w-full max-w-none translate-y-0 gap-0 overflow-hidden rounded-t-[2.5rem] p-0 outline-none sm:top-1/2 sm:bottom-auto sm:max-w-md sm:-translate-y-1/2 sm:rounded-2xl",children:e.jsxs("div",{className:"flex flex-col bg-white pb-8",children:[e.jsx("div",{className:"mx-auto my-3 h-1.5 w-12 rounded-full bg-gray-200 sm:hidden"}),e.jsx(X,{className:"px-6 py-4",children:e.jsxs(B,{className:"text-xl font-black text-indigo-600 italic",children:["ORDEN #",h?.id]})}),e.jsx("div",{className:"max-h-[70dvh] overflow-y-auto px-6",children:h&&e.jsx(Y,{order:h})})]})})})]})}const D=o.memo(({status:i})=>{const n={pending:0,confirmed:1,ready_for_pickup:2,picked_up:3,on_the_way:4,delivered:5}[i]??0;return e.jsx("div",{className:"flex w-full items-start justify-between",children:T.map((d,r)=>e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[r!==0&&e.jsx("div",{className:`absolute top-2 right-1/2 left-[-50%] h-[1px] ${r<=n?"bg-slate-300":"bg-slate-100"}`}),e.jsxs("div",{className:`relative z-10 h-3.5 w-3.5 rounded-full border transition-all duration-500 ${r<n?"border-emerald-400 bg-emerald-50":r===n?"border-slate-400 bg-white shadow-sm":"border-slate-200 bg-white"}`,children:[r<n&&e.jsx(G,{className:"h-full w-full p-0.5 text-emerald-500"}),r===n&&e.jsx("div",{className:"absolute inset-0 m-auto h-1 w-1 rounded-full bg-slate-400"})]})]}),e.jsx("span",{className:`mt-2 text-[7px] font-bold tracking-tight uppercase ${r===n?"text-slate-600":"text-slate-300"}`,children:d.label})]},d.key))})}),Y=o.memo(({order:i})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl bg-gray-50 p-4 ring-1 ring-black/5",children:e.jsx(D,{status:i.status})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-3 text-[11px] font-bold tracking-widest text-gray-400 uppercase",children:"Tus Productos"}),e.jsx("div",{className:"space-y-3",children:i.items.map(t=>e.jsx("div",{className:"flex items-center justify-between rounded-xl bg-white p-3 shadow-sm ring-1 ring-black/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"flex h-7 w-7 items-center justify-center rounded-lg bg-indigo-100 text-xs font-bold text-indigo-600",children:[t.quantity,"x"]}),e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:t.name})]})},t.id))})]})]}));export{_e as default};

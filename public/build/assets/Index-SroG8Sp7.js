const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapDelivery-CzNZXRR5.js","assets/vendor-core-exSyXSqW.js","assets/icons-DUN4oFg2.js","assets/app-Lsx9vzYk.js","assets/app-UAH-NDiG.js","assets/app-BYlnwbUj.css","assets/app-CLLlcC51.css"])))=>i.map(i=>d[i]);
import{_ as E}from"./app-Lsx9vzYk.js";import{e as C,r as t,j as e,d as o}from"./vendor-core-exSyXSqW.js";import{B as d}from"./button-DROHPe1W.js";import{C as p,a as u}from"./card-D5k2MC8Y.js";import{L as S}from"./label-BJtWGace.js";import{S as R}from"./switch-sDS8LI1G.js";import{M as A}from"./main-layout-XgZxIlet.js";import{y as l}from"./index-zdFYkwEh.js";import{a2 as P,a3 as L,c as D,s as O}from"./vendor-icons-C0rekE6d.js";import"./app-UAH-NDiG.js";import"./vendor-ui-BC6GVMXR.js";import"./utils-ZvPxgyVA.js";import"./index-BU_B9Ap-.js";import"./drawer-cart-DmonbQGW.js";import"./CartFloatButton-CwmvMEWj.js";const $=t.lazy(()=>E(()=>import("./MapDelivery-CzNZXRR5.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function U({activeOrder:i}){const{auth:b}=C().props,{user:a}=b,g=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),r=!!i,[c,x]=t.useState([]),[h,f]=t.useState(!0),[v]=t.useState(null);t.useRef(null);const m=t.useCallback(async()=>{if(!(!a.is_available||r))try{const s=await fetch("/delivery/orders/available",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!s.ok)return;const n=await s.json();x(n)}catch(s){console.error(s)}},[a.is_available,r]);t.useEffect(()=>{if(!h||r)return;m();const s=setInterval(m,2e4);return()=>clearInterval(s)},[m,h,r]);const j=async s=>{try{const n=await fetch(`/delivery/orders/${s}/accept`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":g??"","Content-Type":"application/json"}});if(!n.ok){const _=await n.json();return l.error(_.message??"Error")}l.success("Pedido aceptado ðŸš´â€â™‚ï¸"),x([]),f(!1),o.reload({only:["activeOrder"]})}catch{l.error("Error de conexiÃ³n")}},y=()=>{o.patch("/delivery/availability",{status:!a.is_available})},N=()=>{const s=new Audio("/sounds/blocked.mp3");s.volume=.6,s.play().catch(()=>{})},w=()=>{o.post(`/delivery/orders/${i.id}/on-the-way`,{},{onSuccess:()=>{l.success("En camino ðŸš´â€â™‚ï¸"),o.reload({only:["activeOrder"]})},onError:s=>l.error(s.message??"Error")})},k=()=>{o.post(`/delivery/orders/${i.id}/delivered`,{},{onSuccess:()=>{l.success("Entregado ðŸ“¦"),o.reload({only:["activeOrder"]})},onError:s=>l.error(s.message??"Error")})};return e.jsx(A,{children:e.jsxs("div",{className:"min-h-screen space-y-2 bg-purple-50/50 p-2",children:[c.length>0&&!r&&a.is_available&&e.jsx(p,{className:"animate-pulse rounded-lg border-amber-200 bg-amber-50 shadow-md",children:e.jsxs(u,{className:"space-y-1 p-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-amber-600"}),e.jsx("p",{className:"text-sm font-semibold tracking-tight text-amber-900 uppercase",children:"Â¡Nueva Solicitud!"})]}),e.jsxs("div",{className:"flex items-center gap-1 font-bold text-amber-700",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"text-base leading-none",children:c[0].delivery_fee})]})]}),e.jsxs(d,{className:"w-full rounded-lg bg-amber-600 py-2 text-sm font-bold tracking-widest text-white uppercase shadow-lg shadow-amber-200 hover:bg-amber-700 active:scale-95",onClick:()=>j(c[0].id),children:["Aceptar Pedido #",c[0].id]})]})}),r&&a.is_available&&e.jsx(p,{className:"rounded-lg border-purple-200 bg-white shadow-sm animate-in slide-in-from-bottom-2",children:e.jsxs(u,{className:"space-y-1 p-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-purple-600"}),e.jsx("p",{className:"text-sm font-semibold tracking-tight text-purple-900",children:"Pedido en curso"})]}),e.jsxs("span",{className:"text-[10px] font-bold text-purple-500 uppercase",children:["#",i.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{className:"flex-1 rounded-lg bg-purple-600 text-xs font-semibold transition-all hover:bg-purple-700 active:scale-95",children:"LleguÃ©"}),i.status==="picked_up"&&e.jsx(d,{className:"flex-1 rounded-lg bg-green-600 text-xs font-semibold hover:bg-green-700 active:scale-95",onClick:w,children:"Iniciar Ruta"}),i.status==="on_the_way"&&e.jsx(d,{className:"flex-1 rounded-lg bg-blue-600 text-xs font-semibold hover:bg-blue-700 active:scale-95",onClick:k,children:"Entregar"})]})]})}),e.jsx(p,{className:`overflow-hidden rounded-lg border-purple-200 p-0 shadow-sm ${a.is_available?"":"bg-gray-300"}`,children:e.jsxs(u,{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:"https://i.pravatar.cc/100",alt:"Repartidor",className:"h-10 w-10 rounded-full border border-purple-100"}),e.jsx("div",{className:`absolute -right-0.5 -bottom-0.5 h-3 w-3 rounded-full border-2 border-white ${a.is_available?"bg-green-500":"bg-gray-400"}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm leading-tight font-semibold text-purple-900",children:a.name}),e.jsx("p",{className:"text-[10px] font-semibold tracking-wider text-gray-500 uppercase",children:"Repartidor"})]})]}),e.jsxs("div",{className:`flex items-center gap-2 rounded-lg border border-purple-100 bg-purple-50/50 px-2 py-1.5 transition-opacity ${r?"opacity-50":""}`,children:[e.jsx(S,{htmlFor:"disponibilidad",className:"text-[10px] font-bold text-purple-800 uppercase",children:a.is_available?"En lÃ­nea":"Desconectado"}),e.jsx("div",{onClick:()=>r&&N(),children:e.jsx(R,{id:"disponibilidad",checked:a.is_available,disabled:r,onCheckedChange:y,className:"focus-visible:ring-purple-400 data-[state=checked]:bg-purple-600"})})]})]})}),a.is_available?e.jsx(p,{className:"relative h-65 overflow-hidden rounded-lg border-purple-200 py-0 shadow-sm",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full animate-pulse items-center justify-center bg-gray-100",children:e.jsx("p",{className:"text-xs text-gray-400",children:"Cargando mapa..."})}),children:e.jsx($,{deliveryLocation:v})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-purple-100 bg-purple-50/30 py-12 text-center",children:[e.jsx("div",{className:"mb-4 rounded-lg bg-white p-4 shadow-sm",children:e.jsx(O,{className:"h-10 w-10 text-gray-300"})}),e.jsx("h2",{className:"text-base font-semibold tracking-tight text-gray-700 uppercase",children:"Actualmente no puedes recibir pedidos"}),e.jsx("p",{className:"mt-1 text-[10px] leading-tight font-normal tracking-widest text-gray-500 uppercase",children:"Activa tu disponibilidad para comenzar a trabajar"})]})]})})}export{U as default};

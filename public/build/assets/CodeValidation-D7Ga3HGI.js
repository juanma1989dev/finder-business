import{u as j,j as s,d as x,r as b,e as k,H as V}from"./vendor-core-exSyXSqW.js";import{g as S,D as _}from"./dashboard-layout-BNlDeZF5.js";import{y as p,L as F}from"./index-zdFYkwEh.js";import{aA as B,O as K}from"./vendor-icons-C0rekE6d.js";import"./vendor-ui-BC6GVMXR.js";import"./button-DROHPe1W.js";import"./utils-ZvPxgyVA.js";import"./dropdown-menu-Dz3g0mub.js";import"./index-CN9EY2cw.js";import"./index-CVASjcgI.js";import"./index-BU_B9Ap-.js";class h{constructor(t=0,r="Network Error"){this.status=t,this.text=r}}const q=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},n={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:q()},w=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},D=(e,t="https://api.emailjs.com")=>{if(!e)return;const r=w(e);n.publicKey=r.publicKey,n.blockHeadless=r.blockHeadless,n.storageProvider=r.storageProvider,n.blockList=r.blockList,n.limitRate=r.limitRate,n.origin=r.origin||t},L=async(e,t,r={})=>{const o=await fetch(n.origin+e,{method:"POST",headers:r,body:t}),a=await o.text(),i=new h(o.status,a);if(o.ok)return i;throw i},P=(e,t,r)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},M=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},N=e=>e.webdriver||!e.languages||e.languages.length===0,C=()=>new h(451,"Unavailable For Headless Browser"),O=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},A=e=>!e.list?.length||!e.watchVariable,I=(e,t)=>e instanceof FormData?e.get(t):e[t],E=(e,t)=>{if(A(e))return!1;O(e.list,e.watchVariable);const r=I(t,e.watchVariable);return typeof r!="string"?!1:e.list.includes(r)},R=()=>new h(403,"Forbidden"),G=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},U=async(e,t,r)=>{const o=Number(await r.get(e)||0);return t-Date.now()+o},T=async(e,t,r)=>{if(!t.throttle||!r)return!1;G(t.throttle,t.id);const o=t.id||e;return await U(o,t.throttle,r)>0?!0:(await r.set(o,Date.now().toString()),!1)},H=()=>new h(429,"Too Many Requests"),$=async(e,t,r,o)=>{const a=w(o),i=a.publicKey||n.publicKey,u=a.blockHeadless||n.blockHeadless,c=a.storageProvider||n.storageProvider,d={...n.blockList,...a.blockList},m={...n.limitRate,...a.limitRate};return u&&N(navigator)?Promise.reject(C()):(P(i,e,t),M(r),r&&E(d,r)?Promise.reject(R()):await T(location.pathname,m,c)?Promise.reject(H()):L("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:i,service_id:e,template_id:t,template_params:r}),{"Content-type":"application/json"}))},J=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},z=e=>typeof e=="string"?document.querySelector(e):e,W=async(e,t,r,o)=>{const a=w(o),i=a.publicKey||n.publicKey,u=a.blockHeadless||n.blockHeadless,c=n.storageProvider||a.storageProvider,d={...n.blockList,...a.blockList},m={...n.limitRate,...a.limitRate};if(u&&N(navigator))return Promise.reject(C());const g=z(r);P(i,e,t),J(g);const l=new FormData(g);return E(d,l)?Promise.reject(R()):await T(location.pathname,m,c)?Promise.reject(H()):(l.append("lib_version","4.4.1"),l.append("service_id",e),l.append("template_id",t),l.append("user_id",i),L("/api/v1.0/email/send-form",l))},Q={init:D,send:$,sendForm:W,EmailJSResponseStatus:h};function X({props:e,setStausCodeValidation:t,setGeneratedCode:r,urlBusiness:o}){const{auth:a}=e,{user:i}=a,{post:u,processing:c}=j({email:i?.email||""}),d=()=>{u("/dashboard/profile/business/code-to-create",{preserveScroll:!0,onSuccess:m=>{const l=m.props?.flash?.meta,f=S(l,"code");if(!f){p.error("No se pudo obtener el código.");return}const v={codigo:f,name:i?.name,email:i?.email};Q.send("service_20p7y6r","template_qz241al",v,{publicKey:"x_RrCLCpP0c42oE-t"}).then(()=>{t(!0),r(f)},()=>p.error("Error al enviar el código."))},onError:()=>p.error("Error al generar el código.")})};return s.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center gap-6 p-3",children:[s.jsx("h1",{className:"text-xl font-bold",children:"Generar código"}),s.jsxs("div",{className:"w-full max-w-lg text-center",children:[s.jsx("p",{children:"Para registrar su negocio, es necesario validar previamente su identidad."}),s.jsx("p",{children:"Enviaremos un código de confirmación a su correo electrónico."})]}),s.jsxs("div",{className:"flex w-full max-w-lg justify-center gap-5",children:[s.jsxs("button",{disabled:c,className:`flex items-center gap-3 rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 ${c?"cursor-not-allowed bg-gray-400":"cursor-pointer bg-gray-200 hover:bg-gray-300"}`,onClick:()=>x.get(o),children:[s.jsx(B,{className:"h-4 w-4"}),"Cancelar"]}),s.jsxs("button",{onClick:d,disabled:c,className:`flex items-center justify-center gap-3 rounded-md bg-sky-600 px-4 py-2 text-white hover:bg-sky-700 ${c?"cursor-not-allowed bg-gray-400":"cursor-pointer"}`,children:[s.jsx(K,{className:"h-4 w-4"}),c?s.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"}):"Recibir código"]})]})]})}function Y({props:e,code:t}){const[r]=b.useState(180),[o,a]=b.useState(""),{auth:i}=k().props,{user:u}=i,c=u?.email,{processing:d,post:m}=j({code:t,email:c});b.useEffect(()=>{t&&p.success("El código se envió correctamente.")},[]);const g=async()=>{o===t?m("/dashboard/profile/business/validate-code",{preserveScroll:!0,onSuccess:l=>{const v=l.props?.flash?.meta;if(S(v,"validated")>0)return x.get("/dashboard/business/create",{validate:btoa(t)});p.error("Error al validar el código")},onError:()=>{p.error("Error al validar el código")}}):p.error("Código incorrecto")};return s.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6 p-3 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:s.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[s.jsxs("span",{children:["El código es válido por: ",Math.floor(r/60),":",(r%60).toString().padStart(2,"0")," minutos."]}),s.jsx("input",{type:"text",placeholder:"Ingresa el código",value:o,onChange:l=>a(l.target.value),className:"w-full rounded-md border p-2"}),s.jsx("button",{onClick:g,disabled:d,className:`flex items-center justify-center rounded-md px-4 py-2 text-white ${d?"cursor-not-allowed bg-green-300":"cursor-pointer bg-green-500 hover:opacity-90"}`,children:d?s.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"}):"Validar código"})]})})}const Z=[{title:"Dashboard - Nuevo negocio",href:""}],y="/dashboard/profile/business/";function me({numBusiness:e}){const[t,r]=b.useState(!1),[o,a]=b.useState(null),i=k().props;return e>=5?x.visit(y):s.jsxs(_,{breadcrumbs:Z,children:[s.jsx(F,{}),s.jsx(V,{title:"Dashboard - Nuevo negocio - "}),s.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:s.jsx("div",{className:"relative min-h-[100vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:!t&&!o?s.jsx(X,{props:i,stausCodeValidation:t,setStausCodeValidation:r,generatedCode:o,setGeneratedCode:a,urlBusiness:y}):s.jsx(Y,{props:i,code:o})})})]})}export{me as default};

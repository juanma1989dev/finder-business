import{r,j as t,d as w}from"./vendor-core-VmliHTPN.js";import{D as k}from"./dashboard-layout-r_HPZSjW.js";import{O as n}from"./index-BU_B9Ap-.js";import{y as f}from"./index-CJCtTEqR.js";import L from"./GridOrders-DY3K-78v.js";import T from"./NotesDialog-Bvsy1foH.js";import h from"./Stat-DqtgAZ-I.js";import{t as R,u as A,v as B}from"./vendor-icons-DuiFzXC9.js";import"./vendor-ui-g7ZgVefF.js";import"./button-UqOExDgN.js";import"./utils-CXBz3L1W.js";import"./dropdown-menu-DU8L8uPh.js";import"./index-CN9EY2cw.js";import"./index-CVASjcgI.js";import"./useOrderStatus-GqTjcJ4U.js";import"./OrderCard-CGJ-hOyL.js";var E=(o=>(o.Todos="Todos",o.Pendiente="Pendiente",o.Confirmado="Confirmado",o.Entregado="Entregado",o))(E||{});const F=[n.CANCELLED,n.REJECTED];function ee({breadcrumbs:o,orders:d,business:c}){const[m,b]=r.useState(!!c?.is_open),[i,N]=r.useState("Todos"),[p,S]=r.useState(""),[C,v]=r.useState(null),[a,u]=r.useState({open:!1}),[l,x]=r.useState("");r.useEffect(()=>{const e=s=>{s.key==="Escape"&&(u({open:!1}),x("")),s.key==="Enter"&&a.open&&l.trim()&&g(a.orderId,a.status,l)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,l]);const y=()=>{const e=m;b(!e),w.patch(`/dashboard/business/${c.id}-${c.slug}/opening-hours`,{id:c.id,status:!e},{onError:()=>{b(e),f.error("No se pudo actualizar el negocio")}})},D=(e,s)=>{if(s&&F.includes(s)){u({open:!0,orderId:e,status:s});return}g(e,s)},g=(e,s,P)=>{v(e),w.patch(`/dashboard/orders/${e}/status`,{status:s,note:P},{preserveScroll:!0,onSuccess:()=>{f.success("Pedido actualizado"),u({open:!1}),x("")},onError:()=>f.error("Error al actualizar pedido"),onFinish:()=>v(null)})},j=r.useMemo(()=>d.filter(e=>{if(p){const s=p.toLowerCase();if(!e.id.toString().includes(s)&&!e.user?.name?.toLowerCase().includes(s))return!1}return i==="Pendiente"?e.status===n.PENDING:i==="Confirmado"?e.status===n.CONFIRMED:i==="Entregado"?e.status===n.DELIVERED:!0}),[d,p,i]),O=d.filter(e=>e.status===n.PENDING).length,I=d.filter(e=>e.status===n.PENDING).length;return t.jsxs(k,{breadcrumbs:o,children:[t.jsxs("div",{className:"flex min-h-screen flex-col gap-3 bg-purple-50/30 p-2 sm:p-2 lg:p-4",children:[t.jsxs("div",{className:"sticky top-14 z-40 rounded-lg border border-purple-200 bg-white p-2 shadow-sm sm:static",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-base font-semibold tracking-tight text-purple-800 uppercase",children:"Pedidos"}),t.jsx("p",{className:"text-[10px] font-normal tracking-widest text-gray-500 uppercase",children:"Gestión de tus pedidos."})]}),t.jsx("button",{onClick:y,className:`flex cursor-pointer items-center gap-2 rounded-lg px-4 py-2 text-[10px] font-semibold uppercase transition-all active:scale-95 ${m?"bg-purple-600 text-white shadow-sm":"border border-amber-200 bg-amber-50 text-amber-700"}`,children:m?t.jsxs(t.Fragment,{children:["Abierto ",t.jsx(R,{className:"h-3.5 w-3.5"})]}):t.jsxs(t.Fragment,{children:["Cerrado ",t.jsx(A,{className:"h-3.5 w-3.5"})]})})]}),t.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[t.jsx(h,{label:"Pendientes",value:O}),t.jsx(h,{label:"Retrasados",value:I,danger:!0}),t.jsx(h,{label:"Filtrados",value:j.length})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(B,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-gray-400"}),t.jsx("input",{className:"w-full rounded-lg border border-purple-200 bg-white py-3 pr-4 pl-10 text-sm font-normal text-gray-700 shadow-sm transition-all focus:border-purple-600 focus:ring-1 focus:ring-purple-600 focus:outline-none",placeholder:"Buscar pedido o cliente…",value:p,onChange:e=>S(e.target.value)})]}),t.jsx("div",{className:"scrollbar-hide flex gap-2 overflow-x-auto pb-1",children:Object.values(E).map(e=>t.jsx("button",{onClick:()=>N(e),className:`rounded-lg px-4 py-2 text-[10px] font-semibold whitespace-nowrap uppercase transition-all active:scale-95 ${i===e?"bg-purple-600 text-white shadow-sm":"border border-purple-100 bg-white text-gray-500 hover:bg-purple-50"}`,children:e},e))}),t.jsx("div",{className:"relative min-h-[400px]",children:t.jsx(L,{orders:j,loadingOrderId:C,onChangeStatus:D})})]}),t.jsx(T,{open:a.open,value:l,onChange:x,onClose:()=>u({open:!1,orderId:null,status:void 0}),onConfirm:()=>g(a.orderId,a.status,l)})]})}export{ee as default};

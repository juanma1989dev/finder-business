const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MainFilters-CfFa2WrA.js","assets/vendor-core-VmliHTPN.js","assets/vendor-icons-AXEXEb4U.js","assets/BusinessCard-BvN2OqnS.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./app-B6TFEqqM.js";import{r as s,d as w,j as e}from"./vendor-core-VmliHTPN.js";import{D as k,b as O,c as T}from"./dialog-vzLoSVqm.js";import{M as D}from"./main-layout-EDLG_LKB.js";import{B as L}from"./vendor-ui-BLZZ21YU.js";import{p as A,N as G}from"./vendor-icons-AXEXEb4U.js";import"./app-D1mVeRFJ.js";import"./utils-DA-8Si8A.js";import"./index-DdSA57g9.js";import"./CartFloatButton-GQ3x6lyW.js";import"./drawer-cart-B1jjc39m.js";const j="geo_coords",H=1200*1e3;function I(){try{const r=sessionStorage.getItem(j);if(!r)return null;const t=JSON.parse(r);return Date.now()-t.timestamp>H?(sessionStorage.removeItem(j),null):t}catch{return null}}function P(r,t){sessionStorage.setItem(j,JSON.stringify({lat:r,lng:t,timestamp:Date.now()}))}function R(r){const t=r?.enabled??!0,[o,i]=s.useState(null),[v,y]=s.useState(null),[g,c]=s.useState(!1),[p,x]=s.useState(null);return s.useEffect(()=>{if(!t)return;const l=I();if(l){i(l.lat),y(l.lng);return}if(!navigator.geolocation){x("Geolocation not supported");return}c(!0),navigator.geolocation.getCurrentPosition(a=>{const f=a.coords.latitude,h=a.coords.longitude;i(f),y(h),P(f,h),c(!1)},()=>{x("Permission denied"),c(!1)},{enableHighAccuracy:r?.enableHighAccuracy??!1})},[t]),{latitude:o,longitude:v,loading:g,error:p}}const q=s.lazy(()=>S(()=>import("./MainFilters-CfFa2WrA.js"),__vite__mapDeps([0,1,2]))),M=s.lazy(()=>S(()=>import("./BusinessCard-BvN2OqnS.js"),__vite__mapDeps([3,1,2]))),N=[{key:"pending",label:"Creado"},{key:"confirmed",label:"Confirmado"},{key:"ready_for_pickup",label:"Listo para recoger"},{key:"picked_up",label:"Recogido"},{key:"on_the_way",label:"En camino"},{key:"delivered",label:"Entregado"}];function se({businesses:r,categories:t,filters:o,products:i,activeOrder:v}){const[y,g]=s.useState(!1),c=s.useRef(null),[p,x]=s.useState(!1),[l]=s.useState(null),[a,f]=s.useState({query:o.q||"",category:o.category||null,distance:o.distance||5,foodType:null}),[h,_]=s.useState(!1),{latitude:d,longitude:u,error:E,loading:b}=R(h?{enableHighAccuracy:!1}:null);s.useEffect(()=>{const n=setTimeout(()=>_(!0),1500);return()=>clearTimeout(n)},[]);const C=s.useCallback(()=>{g(!0);const n={q:a.query,category:a.category,distance:a.distance,foodType:a.foodType},m={};typeof d=="number"&&typeof u=="number"&&(m["X-Latitude"]=d.toString(),m["X-Longitude"]=u.toString()),w.get("/",n,{headers:m,only:["businesses","meta","filters"],preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>g(!1)})},[a,d,u]);return s.useEffect(()=>{if(b)return;const n=JSON.stringify({filtersUser:a,latitude:d,longitude:u});if(c.current===n)return;c.current=n;const m=setTimeout(()=>{C()},120);return()=>clearTimeout(m)},[a,d,u,b]),e.jsxs(D,{children:[e.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",children:[b&&e.jsx("div",{className:"mx-4 my-2 rounded-xl bg-blue-50 px-3 py-2 text-xs text-blue-600",children:"ðŸ“ Obteniendo tu ubicaciÃ³n para mostrar negocios cercanosâ€¦"}),e.jsx("div",{className:"px-4 pt-2 pb-3",children:e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"h-16 animate-pulse rounded-xl bg-gray-50"}),children:e.jsx(q,{categories:t,filters:a,onFiltersChange:f,foodTypes:i.categories})})}),E&&e.jsxs("div",{className:"mx-4 mb-2 flex items-center gap-2 rounded-full bg-amber-50 px-3 py-1 text-amber-600",children:[e.jsx(A,{size:12}),e.jsx("span",{className:"text-[10px] font-bold",children:"Habilita el GPS para ver distancia real"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-24",children:e.jsx("div",{className:"py-2",children:e.jsx(s.Suspense,{fallback:e.jsx(z,{}),children:e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:r.map(n=>e.jsx(M,{business:n},n.id))})})})})]}),p&&e.jsx(k,{open:p,onOpenChange:x,children:e.jsxs(L,{className:"bottom-0 w-full rounded-t-3xl p-0 sm:max-w-md",children:[e.jsx(O,{className:"p-4",children:e.jsxs(T,{children:["ORDEN #",l?.id]})}),l&&e.jsx(F,{order:l})]})})]})}const z=()=>e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((r,t)=>e.jsxs("div",{className:"animate-pulse rounded-[2rem] border bg-white p-2",children:[e.jsx("div",{className:"h-48 rounded-[1.6rem] bg-gray-200"}),e.jsxs("div",{className:"space-y-3 p-3",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-gray-200"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-gray-200"}),e.jsx("div",{className:"h-8 rounded bg-gray-100"})]})]},t))}),B=s.memo(({status:r})=>{const t=N.findIndex(o=>o.key===r);return e.jsx("div",{className:"flex justify-between",children:N.map((o,i)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"h-3 w-3 rounded-full border",children:i<t&&e.jsx(G,{className:"h-full w-full"})}),e.jsx("span",{className:"mt-1 text-[8px]",children:o.label})]},o.key))})}),F=s.memo(({order:r})=>e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(B,{status:r.status}),r.items.map(t=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.quantity,"x"]}),e.jsx("span",{children:t.name})]},t.id))]}));export{se as default};
